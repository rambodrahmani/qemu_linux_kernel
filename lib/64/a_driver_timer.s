#*******************************************************************************
# File: a_driver_timer.s
#       Interrupt primitive 40.
#
# Author: Rambod Rahmani <rambodrahmani@autistici.org>
#         Created on 07/07/2019.
#*******************************************************************************

#-------------------------------------------------------------------------------
#include "../libqlk.s"
#-------------------------------------------------------------------------------
.TEXT
#-------------------------------------------------------------------------------
.EXTERN c_driver_timer
#-------------------------------------------------------------------------------
.GLOBAL a_driver_timer
#-------------------------------------------------------------------------------
a_driver_timer:
    save_registers              # push all registers

    call  c_driver_timer        # call driver
    movq  $0xFEE000B0, %rax     # write End Of Interrupt
    movl  $0, (%rax)
    
    restore_registers           # pop all registers
    
    iretq                       # return from interrupt
#*******************************************************************************

