#*******************************************************************************
# File: user.s
#       User Module Assembly implementation.
#       The User Module only contains the user.s source code file which contains
#       the assembly implementation for the primitives available to the user
#       module and the lib.cpp containing utility methods.
#
# Author: Rambod Rahmani <rambodrahmani@autistici.org>
#         Created on 31/08/2019.
#*******************************************************************************

#-------------------------------------------------------------------------------
#include <constants.h>
#-------------------------------------------------------------------------------
.GLOBAL _start, start                                  # User Module Entry Point
#-------------------------------------------------------------------------------
_start:
start:
    .cfi_startproc
    call lib_init
    jmp  main                   # jump to utente.cpp/main()
    .cfi_endproc

////////////////////////////////////////////////////////////////////////////////
//            AVAILABLE USER SYSTEM CALLS AND PRIMITIVES                      //
////////////////////////////////////////////////////////////////////////////////

#-------------------------------------------------------------------------------
.TEXT
.GLOBAL activate_p
#-------------------------------------------------------------------------------
activate_p:
    .cfi_startproc
    int $TIPO_A
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL terminate_p
#-------------------------------------------------------------------------------
terminate_p:
    .cfi_startproc
    int $TIPO_T
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL sem_ini
#-------------------------------------------------------------------------------
sem_ini:
    .cfi_startproc
    int $TIPO_SI
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL sem_wait
#-------------------------------------------------------------------------------
sem_wait:
    .cfi_startproc
    int $TIPO_W
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL sem_signal
#-------------------------------------------------------------------------------
sem_signal:
    .cfi_startproc
    int $TIPO_S
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL delay
#-------------------------------------------------------------------------------
delay:
    .cfi_startproc
    int $TIPO_D
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL readse_n
#-------------------------------------------------------------------------------
readse_n:
    .cfi_startproc
    int $IO_TIPO_RSEN
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL readse_ln
#-------------------------------------------------------------------------------
readse_ln:
    .cfi_startproc
    int $IO_TIPO_RSELN
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL writese_n
#-------------------------------------------------------------------------------
writese_n:
    .cfi_startproc
    int $IO_TIPO_WSEN
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL writese_0
#-------------------------------------------------------------------------------
writese_0:
    .cfi_startproc
    int $IO_TIPO_WSE0
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL readconsole
#-------------------------------------------------------------------------------
readconsole:
    .cfi_startproc
    int $IO_TIPO_RCON
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL writeconsole
#-------------------------------------------------------------------------------
writeconsole:
    .cfi_startproc
    int $IO_TIPO_WCON
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL iniconsole
#-------------------------------------------------------------------------------
iniconsole:
    .cfi_startproc
    int $IO_TIPO_INIC
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL readhd_n
#-------------------------------------------------------------------------------
readhd_n:
    .cfi_startproc
    int $IO_TIPO_HDR
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL writehd_n
#-------------------------------------------------------------------------------
writehd_n:
    .cfi_startproc
    int $IO_TIPO_HDW
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL dmareadhd_n
#-------------------------------------------------------------------------------
dmareadhd_n:
    .cfi_startproc
    int $IO_TIPO_DMAHDR
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL dmawritehd_n
#-------------------------------------------------------------------------------
dmawritehd_n:
    .cfi_startproc
    int $IO_TIPO_DMAHDW
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL do_log
#-------------------------------------------------------------------------------
do_log:
    .cfi_startproc
    int $TIPO_L
    ret
    .cfi_endproc

#-------------------------------------------------------------------------------
.GLOBAL getid
#-------------------------------------------------------------------------------
getid:
    .cfi_startproc
    int $TIPO_GETID
    ret
    .cfi_endproc
#*******************************************************************************

